<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Currency Quotes</title>
    <link rel="stylesheet" href="Styles/styles.css">
    <script src="/Scripts/jquery-3.3.1.min.js"></script>
    <script src="/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <script src="/signalr/hubs"></script>
    <script>
        $(function () {
            var currencyQuoteHub = $.connection.currencyQuoteHub;
            currencyQuoteHub.client.UpdateCurrencyQuote = function (currencyQuote) {
                $('#exchange-rate').text(currencyQuote.ExchangeRate);
                $('#last-refreshed').text(currencyQuote.LastRefreshed);
            };
            $.connection.hub.start().done(function () {

                $('#startButton').click(function () {
                    // Disable the start button
                    $('#startButton').prop('disabled', true);

                    // Disable the select elements
                    $('#from-currency').prop('disabled', true);
                    $('#to-currency').prop('disabled', true);

                    var fromCurrency = $('#from-currency').val();
                    var toCurrency = $('#to-currency').val(); 
                    
                    $.ajax({
                        type: 'POST',
                        url: '/api/CurrencyQuote/Start',
                        data: { FromCurrency: fromCurrency, ToCurrency: toCurrency },
                        success: function (data) {
                            console.log(data);
                        },
                        error: function (xhr, textStatus, errorThrown) {
                            console.log(xhr.responseText);
                        }
                    });
                    /*currencyQuoteHub.server.start(fromCurrency, toCurrency);*/
                });
                $('#stop').click(function () {
                    // Enable the start button
                    $('#start').prop('disabled', false);

                    // Enable the select elements
                    $('#from-currency').prop('disabled', false);
                    $('#to-currency').prop('disabled', false);
                    currencyQuoteHub.server.stop();
                });
                $('#get-quotes').click(function () {
                    var fromCurrency = $('#from-currency').val();
                    var toCurrency = $('#to-currency').val();
                    currencyQuoteHub.server.getQuotes(fromCurrency, toCurrency).done(function (currencyQuote) {
                        $('#exchange-rate').text(currencyQuote.ExchangeRate);
                        $('#last-refreshed').text(currencyQuote.LastRefreshed);
                    });
                });
            });
        });
    </script>
</head>
<body>
    <div id="container">
        <div class="currency-select">
            <label for="from-currency">From Currency:</label>
            <select id="from-currency">
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
                <option value="GBP">GBP</option>
                <option value="JPY">JPY</option>
                <option value="CHF">CHF</option>
            </select>
        </div>
        <div class="currency-select">
            <label for="to-currency">To Currency:</label>
            <select id="to-currency">
                <option value="EUR">EUR</option>
                <option value="USD">USD</option>
                <option value="GBP">GBP</option>
                <option value="JPY">JPY</option>
                <option value="CHF">CHF</option>
            </select>
        </div>
        <div class="currency-buttons">
            <button id="startButton">Start</button>
            <button id="stop">Stop</button>
            <button id="get-quotes">Get Quotes</button>
        </div>
        <div class="currency-display">
            <label for="exchange-rate">Exchange Rate:</label>
            <span id="exchange-rate"></span>
        </div>
        <div class="currency-display">
            <label for="last-refreshed">Last Refreshed:</label>
            <span id="last-refreshed"></span>
        </div>
    </div>

</body>
</html>
